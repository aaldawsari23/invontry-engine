---BEGIN index.html---\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\" dir=\\\"ltr\\\">\\n<head>\\n    <meta charset=\\\"UTF-8\\\" />\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n    <title>PT Inventory Analyzer</title>\\n    <script src=\\\"https://cdn.tailwindcss.com\\\"></script>\\n    <link rel=\\\"preconnect\\\" href=\\\"https://rsms.me/\\\">\\n    <link rel=\\\"stylesheet\\\" href=\\\"https://rsms.me/inter/inter.css\\\">\\n    <style>\\n      :root { font-family: \'Inter\', sans-serif; }\\n      @supports (font-variation-settings: normal) {\\n        :root { font-family: \'Inter var\', sans-serif; }\\n      }\\n      @keyframes fade-in {\\n            from { opacity: 0; transform: scale(0.95); }\\n            to { opacity: 1; transform: scale(1); }\\n      }\\n      .animate-fade-in {\\n          animation: fade-in 0.2s ease-out forwards;\\n      }\\n    </style>\\n</head>\\n<body class=\\\"bg-slate-900 text-slate-300\\\">\\n    <div id=\\\"root\\\"></div>\\n    <script src=\\\"https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\\\"></script>\\n    <script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js\\\"></script>\\n    <script>\\n        const translations = {\\n            en: {\\n                header_title: \\\"PhysioTherapy Inventory Analyzer\\\",\\n                header_subtitle: \\\"Upload your inventory file to instantly classify and score items for PT relevance.\\\",\\n                toggle_language_aria: \\\"Toggle language to Arabic\\\",\\n                upload_click: \\\"Click to upload\\\",\\n                upload_drag_drop: \\\"or drag and drop\\\",\\n                upload_supported_files: \\\"Excel, CSV, or JSON inventory file\\\",\\n                button_analyzing: \\\"Analyzing...\\\",\\n                button_analyze_now: \\\"Analyze Now\\\",\\n                alert_invalid_file: \\\"Please upload a valid JSON, CSV, or Excel file.\\\",\\n                loader_analyzing: \\\"Analyzing Your Inventory\\\",\\n                dashboard_title: \\\"Analysis Summary\\\",\\n                dashboard_category_breakdown: \\\"Category Breakdown\\\",\\n                stat_total: \\\"Total Items\\\",\\n                stat_accepted: \\\"Accepted\\\",\\n                stat_review: \\\"Needs Review\\\",\\n                stat_rejected: \\\"Rejected\\\",\\n                table_title: \\\"Detailed Results\\\",\\n                table_variants: \\\"variants\\\",\\n                table_header_item: \\\"Item\\\",\\n                table_header_category: \\\"Category\\\",\\n                table_header_score: \\\"Score\\\",\\n                table_header_status: \\\"Status\\\",\\n                table_no_results: \\\"No results match your filters.\\\",\\n                filter_search_label: \\\"Search\\\",\\n                filter_search_placeholder: \\\"Filter by name, SKU, category...\\\",\\n                filter_category_label: \\\"Category\\\",\\n                filter_score_label: \\\"Score Range\\\",\\n                decision_all: \\\"All\\\",\\n                decision_accepted: \\\"Accepted\\\",\\n                decision_review: \\\"Review\\\",\\n                decision_rejected: \\\"Rejected\\\",\\n                error_title: \\\"Analysis Failed\\\",\\n                button_try_again: \\\"Try Again\\\",\\n                button_analyze_another: \\\"Analyze Another File\\\",\\n                button_export: \\\"Export Results\\\",\\n                visual_analysis_title: \\\"Visual Analysis\\\",\\n                card_variants: \\\"variants\\\",\\n                card_codes: \\\"Codes:\\\",\\n                card_score: \\\"Score:\\\",\\n                card_item_count: \\\"({count} item)\\\",\\n            },\\n            ar: {\\n                header_title: \\\"محلل مخزون العلاج الطبيعي\\\",\\n                header_subtitle: \\\"ارفع ملف المخزون لتصنيف وتقييم الأصناف فوراً حسب أهميتها للعلاج الطبيعي.\\\",\\n                toggle_language_aria: \\\"تبديل اللغة إلى الإنجليزية\\\",\\n                upload_click: \\\"انقر للرفع\\\",\\n                upload_drag_drop: \\\"أو اسحب وأفلت\\\",\\n                upload_supported_files: \\\"ملف مخزون بصيغة Excel, CSV, أو JSON\\\",\\n                button_analyzing: \\\"جارٍ التحليل...\\\",\\n                button_analyze_now: \\\"حلل الآن\\\",\\n                alert_invalid_file: \\\"يرجى رفع ملف صالح بصيغة JSON, CSV, أو Excel.\\\",\\n                loader_analyzing: \\\"تحليل مخزونك\\\",\\n                dashboard_title: \\\"ملخص التحليل\\\",\\n                dashboard_category_breakdown: \\\"توزيع الفئات\\\",\\n                stat_total: \\\"إجمالي الأصناف\\\",\\n                stat_accepted: \\\"مقبول\\\",\\n                stat_review: \\\"يحتاج مراجعة\\\",\\n                stat_rejected: \\\"مرفوض\\\",\\n                table_title: \\\"النتائج التفصيلية\\\",\\n                table_variants: \\\"متغيرات\\\",\\n                table_header_item: \\\"الصنف\\\",\\n                table_header_category: \\\"الفئة\\\",\\n                table_header_score: \\\"التقييم\\\",\\n                table_header_status: \\\"الحالة\\\",\\n                table_no_results: \\\"لا توجد نتائج تطابق الفلاتر.\\\",\\n                filter_search_label: \\\"بحث\\\",\\n                filter_search_placeholder: \\\"فلترة بالاسم، SKU، الفئة...\\\",\\n                filter_category_label: \\\"الفئة\\\",\\n                filter_score_label: \\\"نطاق التقييم\\\",\\n                decision_all: \\\"الكل\\\",\\n                decision_accepted: \\\"مقبول\\\",\\n                decision_review: \\\"مراجعة\\\",\\n                decision_rejected: \\\"مرفوض\\\",\\n                error_title: \\\"فشل التحليل\\\",\\n                button_try_again: \\\"حاول مرة أخرى\\\",\\n                button_analyze_another: \\\"تحليل ملف آخر\\\",\\n                button_export: \\\"تصدير النتائج\\\",\\n                visual_analysis_title: \\\"التحليل المرئي\\\",\\n                card_variants: \\\"متغيرات\\\",\\n                card_codes: \\\"الأكواد:\\\",\\n                card_score: \\\"التقييم:\\\",\\n                card_item_count: \\\"({count} عنصر)\\\",\\n            }\\n        };\\n        const knowledgePack = {\\n            \\\"taxonomy\\\": [\\n              { \\\"category\\\": \\\"Equipment & Devices\\\", \\\"subcategories\\\": [\\\"Cardio & Exercise Machines\\\", \\\"Rehabilitation Training Equipment\\\", \\\"Balance & Stability Equipment\\\", \\\"Therapy Gym Equipment\\\", \\\"Exercise Accessories & Therapy Tools\\\", \\\"Hand Therapy & Finger Exercise Tools\\\", \\\"Sensory & Pediatric Therapy Aids\\\", \\\"Treatment Furniture\\\", \\\"Mobility & Transfer Aids\\\", \\\"Daily Living Aids\\\", \\\"Seating & Positioning Equipment\\\", \\\"Robotics & Advanced Systems\\\"] },\\n              { \\\"category\\\": \\\"Modalities\\\", \\\"subcategories\\\": [\\\"Electrotherapy\\\", \\\"Thermal Therapy\\\", \\\"Mechanical Therapy\\\", \\\"Light & Laser Therapy\\\"] },\\n              { \\\"category\\\": \\\"Consumables\\\", \\\"subcategories\\\": [\\\"Tapes & Wraps\\\", \\\"Gels & Lotions\\\", \\\"Electrodes & Wires\\\", \\\"Linens & Covers\\\", \\\"Sanitation & Disinfection\\\"] },\\n              { \\\"category\\\": \\\"Assessment Tools\\\", \\\"subcategories\\\": [\\\"Measurement & Evaluation\\\", \\\"Gait & Motion Analysis\\\", \\\"Strength & ROM Testing\\\"] },\\n              { \\\"category\\\": \\\"Orthotics & Prosthetics\\\", \\\"subcategories\\\": [\\\"Upper Limb Orthotics\\\", \\\"Lower Limb Orthotics\\\", \\\"Spinal Orthotics\\\", \\\"Prosthetics Components\\\"] },\\n              { \\\"category\\\": \\\"Brands\\\", \\\"subcategories\\\": [\\\"Global Brands\\\", \\\"Regional Distributors\\\"] }\\n            ],\\n            \\\"aliases\\\": [\\n              { \\\"canonical\\\": \\\"Treadmill\\\", \\\"variants\\\": [\\\"running machine\\\", \\\"walking treadmill\\\", \\\"alterg\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"gait_training\\\"] },\\n              { \\\"canonical\\\": \\\"Stationary Bike\\\", \\\"variants\\\": [\\\"exercise bike\\\", \\\"recumbent bike\\\", \\\"cycle ergometer\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"cardio\\\"] },\\n              { \\\"canonical\\\": \\\"Ultrasound Therapy\\\", \\\"variants\\\": [\\\"therapeutic ultrasound\\\", \\\"ultrasound machine\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"TENS Unit\\\", \\\"variants\\\": [\\\"tens machine\\\", \\\"transcutaneous electrical nerve stimulation\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"electrotherapy\\\"] },\\n              { \\\"canonical\\\": \\\"Electrode\\\", \\\"variants\\\": [\\\"electrodes\\\", \\\"self-adhesive electrode\\\", \\\"e-stim pads\\\"], \\\"tags\\\": [\\\"consumable\\\", \\\"electrotherapy\\\"] },\\n              { \\\"canonical\\\": \\\"Resistance Band\\\", \\\"variants\\\": [\\\"theraband\\\", \\\"exercise band\\\", \\\"therapy band\\\", \\\"elastic band\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"strengthening\\\"] },\\n              { \\\"canonical\\\": \\\"Parallel Bars\\\", \\\"variants\\\": [\\\"walking bars\\\", \\\"rehab bars\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"gait_training\\\"] },\\n              { \\\"canonical\\\": \\\"Gait Trainer\\\", \\\"variants\\\": [\\\"body-weight support\\\", \\\"litegait\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"gait_training\\\", \\\"neuro\\\"] },\\n              { \\\"canonical\\\": \\\"Wheelchair\\\", \\\"variants\\\": [\\\"manual wheelchair\\\", \\\"power wheelchair\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"Walker\\\", \\\"variants\\\": [\\\"walking frame\\\", \\\"rollator\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"Crutches\\\", \\\"variants\\\": [\\\"axillary crutches\\\", \\\"forearm crutches\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"Goniometer\\\", \\\"variants\\\": [\\\"goniometry\\\"], \\\"tags\\\": [\\\"assessment\\\", \\\"rom\\\"] },\\n              { \\\"canonical\\\": \\\"Dynamometer\\\", \\\"variants\\\": [\\\"hand dynamometer\\\", \\\"grip strength\\\"], \\\"tags\\\": [\\\"assessment\\\", \\\"strength\\\"] },\\n              { \\\"canonical\\\": \\\"Hot Pack\\\", \\\"variants\\\": [\\\"hydrocollator pack\\\", \\\"moist heat pack\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"Cold Pack\\\", \\\"variants\\\": [\\\"ice pack\\\", \\\"cryotherapy pack\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"Chattanooga\\\", \\\"variants\\\": [], \\\"tags\\\": [\\\"brand\\\"] },\\n              { \\\"canonical\\\": \\\"TheraBand\\\", \\\"variants\\\": [\\\"thera-band\\\"], \\\"tags\\\": [\\\"brand\\\"] },\\n              { \\\"canonical\\\": \\\"DJO Global\\\", \\\"variants\\\": [\\\"djo\\\"], \\\"tags\\\": [\\\"brand\\\"] },\\n              { \\\"canonical\\\": \\\"جهاز مشي\\\", \\\"variants\\\": [\\\"الة المشي\\\", \\\"سير كهربائي\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"gait_training\\\"] },\\n              { \\\"canonical\\\": \\\"كرسي متحرك\\\", \\\"variants\\\": [\\\"عربة متحركة\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"عكاز\\\", \\\"variants\\\": [\\\"عكازات\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"مشاية\\\", \\\"variants\\\": [\\\"ووكر\\\"], \\\"tags\\\": [\\\"mobility\\\", \\\"ADL\\\"] },\\n              { \\\"canonical\\\": \\\"شريط مقاومة\\\", \\\"variants\\\": [\\\"حبل مطاطي\\\", \\\"ثيراباند\\\"], \\\"tags\\\": [\\\"equipment\\\", \\\"strengthening\\\"] },\\n              { \\\"canonical\\\": \\\"كمادة حارة\\\", \\\"variants\\\": [\\\"قربة ماء حار\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"كمادة باردة\\\", \\\"variants\\\": [\\\"قربة ثلج\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"قطب كهربائي\\\", \\\"variants\\\": [\\\"الكترود\\\", \\\"لاصق كهربائي\\\"], \\\"tags\\\": [\\\"consumable\\\", \\\"electrotherapy\\\"] },\\n              { \\\"canonical\\\": \\\"جهاز موجات فوق صوتية\\\", \\\"variants\\\": [\\\"جهاز التراساوند علاجي\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"thermal\\\"] },\\n              { \\\"canonical\\\": \\\"جهاز تحفيز كهربائي\\\", \\\"variants\\\": [\\\"جهاز تنس\\\"], \\\"tags\\\": [\\\"modality\\\", \\\"electrotherapy\\\"] }\\n            ],\\n            \\\"negatives\\\": {\\n              \\\"blockers\\\": [\\\"diagnostic ultrasound\\\", \\\"pacs\\\", \\\"ct scanner\\\", \\\"mri coil\\\", \\\"angiography\\\", \\\"sonography\\\", \\\"radiology\\\", \\\"x-ray\\\", \\\"scalpel\\\", \\\"suture\\\", \\\"hemostat\\\", \\\"bone saw\\\", \\\"laparoscope\\\", \\\"anesthesia machine\\\", \\\"dental chair\\\", \\\"pharmacy\\\", \\\"pharmaceutical\\\", \\\"medication\\\", \\\"drug\\\", \\\"tablet\\\", \\\"capsule\\\", \\\"syrup\\\", \\\"vaccine\\\"],\\n              \\\"demotions\\\": [\\\"diagnostic\\\", \\\"imaging\\\", \\\"probe\\\", \\\"radiography\\\", \\\"lab\\\", \\\"reagent\\\", \\\"printer\\\", \\\"toner\\\"]\\n            },\\n            \\\"weights\\\": {\\n              \\\"tag_weights\\\": { \\\"default\\\": 3, \\\"modality\\\": 25, \\\"equipment\\\": 20, \\\"assessment\\\": 18, \\\"orthosis\\\": 18, \\\"prosthetics\\\": 20, \\\"gait_training\\\": 20, \\\"ADL\\\": 15, \\\"mobility\\\": 15, \\\"seating\\\": 15, \\\"brand\\\": 10, \\\"consumable\\\": 8, \\\"strengthening\\\": 7, \\\"post_op\\\": 5, \\\"neuro\\\": 5 },\\n              \\\"score_modifiers\\\": { \\\"diagnostic_blocker\\\": -100, \\\"demotion_term\\\": -25 },\\n              \\\"thresholds\\\": { \\\"accept_min_score\\\": 15, \\\"reject_threshold\\\": -5 },\\n              \\\"category_threshold_overrides\\\": { \\\"Consumables\\\": 10, \\\"Modalities\\\": 18, \\\"Equipment & Devices\\\": 15 },\\n              \\\"brand_boost\\\": { \\\"chattanooga\\\": 5, \\\"theraband\\\": 4, \\\"djo global\\\": 3 },\\n              \\\"variant_patterns\\\": { \\\"side\\\": \\\"\\\\\\\\b(left|right|bilateral|universal|يمين|يسار|ثنائي)\\\\\\\\b\\\", \\\"size\\\": \\\"\\\\\\\\b(\\\\\\\\d+(?:\\\\\\\\.\\\\\\\\d+)?\\\\\\\\s*(?:cm|mm|in|inch|ml|mg|sm|mlm|انش|\'|\\\\\\\\\\\\\\\")|XXXS|XXS|XS|S|M|L|XL|XXL|XXXL|X-Small|Small|Medium|Large|X-Large|XX-Large|XXX-Large|صغير|متوسط|كبير)\\\\\\\\b\\\", \\\"color\\\": \\\"\\\\\\\\b(Red|Green|Blue|Black|White|Gray|Silver|Yellow|Orange|Purple|Pink|Beige|Tan|أحمر|أخضر|أزرق|أسود|أبيض|رمادي|فضي|أصفر|برتقالي|بنفسجي|وردي|بيج)\\\\\\\\b\\\", \\\"resistance\\\": \\\"\\\\\\\\b(Light|Medium|Heavy|X-Heavy|XX-Heavy|Special Heavy|خفيف|متوسط|ثقيل|ثقيل\\\\\\\\s*جدا)\\\\\\\\b\\\" }\\n            }\\n        };\\n        class KnowledgeManager {\\n            get() { return knowledgePack; }\\n            async load() { return Promise.resolve(); }\\n        }\\n        const knowledgeManager = new KnowledgeManager();\\n        function normalizeArabic(s) {\\n            return s.replace(/[\\\\\\\\u064B-\\\\\\\\u065F]/g, \\\'\\\').replace(/[أإآ]/g, \\\'ا\\\').replace(/ة/g, \\\'ه\\\').replace(/ى/g, \\\'ي\\\').replace(/[ؤ]/g, \\\'و\\\').replace(/[ئ]/g, \\\'ي\\\');\\n        }\\n        function trigrams(s) {\\n            const clean = s.replace(/\\\\\\\\s+/g, \\\' \\\').toLowerCase();\\n            if (clean.length < 3) return new Set([clean]);\\n            const grams = new Set();\\n            for (let i = 0; i <= clean.length - 3; i++) {\\n                grams.add(clean.slice(i, i + 3));\\n            }\\n            return grams;\\n        }\\n        class HybridMatcher {\\n            constructor() { this.FUZZY_THRESHOLD = 0.7; }\\n            preProcess(s) { return s ? normalizeArabic(s.toLowerCase()) : \\\'\\\'; }\\n            fuzzy(processedTerm, processedCorpus, originalTerm) {\\n                const termGrams = trigrams(processedTerm);\\n                if (termGrams.size === 0) return null;\\n                const corpusWords = processedCorpus.split(/\\\\\\\\s+/);\\n                let bestMatch = { similarity: 0 };\\n                for (const word of corpusWords) {\\n                    if (word.length < 3) continue;\\n                    const wordGrams = trigrams(word);\\n                    if (wordGrams.size === 0) continue;\\n                    let intersectionSize = 0;\\n                    for (const gram of termGrams) {\\n                        if (wordGrams.has(gram)) intersectionSize++;\\n                    }\\n                    const unionSize = termGrams.size + wordGrams.size - intersectionSize;\\n                    const similarity = unionSize > 0 ? intersectionSize / unionSize : 0;\\n                    if (similarity > bestMatch.similarity) bestMatch.similarity = similarity;\\n                }\\n                if (bestMatch.similarity >= this.FUZZY_THRESHOLD) {\\n                    return { confidence: bestMatch.similarity, strategy: \\\'fuzzy\\\', hit: originalTerm };\\n                }\\n                return null;\\n            }\\n            match(term, corpus) {\\n                const processedTerm = this.preProcess(term);\\n                const processedCorpus = this.preProcess(corpus);\\n                const exactRegex = new RegExp(`\\\\\\\\\\\\\\\\b${processedTerm.replace(/[-\\\\\\\\/\\\\\\\\\\\\\\\\^$*+?.()|[\\\\\\\\]{}]/g, \\\'\\\\\\\\\\\\\\\\$&\\\')}\\\\\\\\\\\\\\\\b`);\\n                if (exactRegex.test(processedCorpus)) return { confidence: 1.0, strategy: \\\'exact\\\', hit: term };\\n                if (processedCorpus.includes(processedTerm)) return { confidence: 0.9, strategy: \\\'substring\\\', hit: term };\\n                const affixTerm = processedTerm.replace(/[^a-z0-9]/gi, \\\'\\\');\\n                if (affixTerm.length > 3) {\\n                    const affixCorpus = processedCorpus.replace(/[^a-z0-9]/gi, \\\'\\\');\\n                    if (affixCorpus.includes(affixTerm)) return { confidence: 0.85, strategy: \\\'affix\\\', hit: term };\\n                }\\n                return this.fuzzy(processedTerm, processedCorpus, term);\\n            }\\n        }\\n        class SmartItemParser {\\n            constructor(variantPatterns) {\\n                this.patterns = this.compilePatterns(variantPatterns);\\n            }\\n            compilePatterns(sourcePatterns) {\\n                const compiled = {};\\n                if (!sourcePatterns) return compiled;\\n                for (const key in sourcePatterns) {\\n                    if (sourcePatterns[key]) {\\n                        try {\\n                            compiled[key] = new RegExp(sourcePatterns[key], \\\'gi\\\');\\n                        } catch (e) {\\n                            console.error(`Invalid regex for pattern \\\'${key}\\\':`, sourcePatterns[key]);\\n                        }\\n                    }\\n                }\\n                return compiled;\\n            }\\n            detectLang(text) {\\n                const arCount = (text.match(/[\\\\\\\\u0600-\\\\\\\\u06FF]/g) || []).length;\\n                if (arCount / Math.max(1, text.length) > 0.4) return \\\'ar\\\';\\n                const enCount = (text.match(/[a-zA-Z]/g) || []).length;\\n                if (enCount / Math.max(1, text.length) > 0.4) return \\\'en\\\';\\n                return \\\'mixed\\\';\\n            }\\n            parse(itemName) {\\n                let baseName = itemName;\\n                const attributes = {};\\n                Object.entries(this.patterns).forEach(([key, regex]) => {\\n                    regex.lastIndex = 0;\\n                    const match = regex.exec(itemName);\\n                    if (match && !attributes[key]) {\\n                        const value = match[1] || match[0];\\n                        switch (key) {\\n                            case \\\'side\\\': attributes.side = /left|يسار/i.test(value) ? \\\'left\\\' : /right|يمين/i.test(value) ? \\\'right\\\' : \\\'universal\\\'; break;\\n                            case \\\'size\\\': attributes.size = value.trim(); break;\\n                            case \\\'color\\\': attributes.color = value.trim(); break;\\n                            case \\\'resistance\\\': attributes.resistance = value.trim(); break;\\n                        }\\n                        baseName = baseName.replace(regex, \\\'\\\');\\n                    }\\n                });\\n                baseName = baseName.replace(/[-_()|,.]+\\\\\\\\s*$/, \\\'\\\').replace(/^[-\\\\\\\\s_()|,.]+/,\\\'\\\').replace(/\\\\\\\\s\\\\\\\\s+/g, \\\' \\\').trim();\\n                return { baseName: baseName || itemName, attributes, language: this.detectLang(itemName) };\\n            }\\n        }\\n        class ContextualScorer {\\n            constructor(knowledgePack) { this.knowledge = knowledgePack; }\\n            calculate(ctx) {\\n                let score = ctx.baseScore;\\n                const explanation = [`Base score from keywords: ${score.toFixed(2)}`];\\n                const corpusLower = ctx.textCorpus.toLowerCase();\\n                for (const blocker of this.knowledge.negatives.blockers) {\\n                    if (corpusLower.includes(blocker)) {\\n                        score += this.knowledge.weights.score_modifiers.diagnostic_blocker;\\n                        explanation.push(`[BLOCKER] Found \\\'${blocker}\\\'. Score decreased by ${this.knowledge.weights.score_modifiers.diagnostic_blocker}.`);\\n                        return { finalScore: Math.round(score), explanation };\\n                    }\\n                }\\n                for (const demotion of this.knowledge.negatives.demotions) {\\n                    if (corpusLower.includes(demotion)) {\\n                        score += this.knowledge.weights.score_modifiers.demotion_term;\\n                        explanation.push(`[DEMOTION] Found \\\'${demotion}\\\'. Score decreased by ${this.knowledge.weights.score_modifiers.demotion_term}.`);\\n                    }\\n                }\\n                if (ctx.matchedCanonicals.has(\\\'Ultrasound Therapy\\\') && corpusLower.includes(\\\'therapeutic\\\')) {\\n                    score += 15;\\n                    explanation.push(`[BOOST] \\\\\\\\\\\\\\\"Ultrasound\\\\\\\\\\\\\\\" + \\\\\\\\\\\\\\\"therapeutic\\\\\\\\\\\\\\\" co-occurrence. Score increased by 15.`);\\n                }\\n                if (ctx.matchedCanonicals.has(\\\'TENS Unit\\\') && ctx.matchedCanonicals.has(\\\'Electrode\\\')) {\\n                    score += 10;\\n                    explanation.push(`[BOOST] \\\\\\\\\\\\\\\"TENS\\\\\\\\\\\\\\\" + \\\\\\\\\\\\\\\"Electrode\\\\\\\\\\\\\\\" co-occurrence. Score increased by 10.`);\\n                }\\n                if (ctx.brand) {\\n                    const brandLower = ctx.brand.toLowerCase();\\n                    const boost = this.knowledge.weights.brand_boost[brandLower] ?? 0;\\n                    if (boost > 0) {\\n                        score += boost;\\n                        explanation.push(`[BOOST] Brand \\\'${ctx.brand}\\\' boost. Score increased by ${boost}.`);\\n                    }\\n                }\\n                return { finalScore: Math.round(score), explanation };\\n            }\\n        }\\n        const workerCode = `\\\\n            self.onmessage = (e) => {\\\\n                const { chunk, knowledgePack } = e.data;\\\\n                // This is a simplified analysis logic, in real scenario, you would have the full analysis logic here.\\\\n                const results = chunk.map((item, index) => ({\\\\n                    id: item.id || \\\\\\\\\\\\`item-\\\\\\\\\\\\\\\${index + 1}\\\\\\\\\\\\\\\`,\\\\n                    item_name: item.item_name,\\\\n                    PT_Category: \\\'Uncategorized\\\',\\\\n                    Score: 10,\\\\n                    Decision: \\\'Review\\\',\\\\n                    Decision_Reason: \\\'Needs manual review\\\',\\\\n                    Matched_Keywords: [],\\\\n                    explanation: { hits: [], context: [] }\\\\n                }));\\\\n                self.postMessage({ results });\\\\n            };\\\\n        `;\\\\n        const workerBlob = new Blob([workerCode], { type: \\\'application/javascript\\\' });\\\\n        const workerUrl = URL.createObjectURL(workerBlob);\\\\n        function analyzeInventoryWithWorker(inventory, knowledgeManager, onProgress) {\\\\n            return new Promise((resolve, reject) => {\\\\n                const worker = new Worker(workerUrl);\\\\n                const knowledgePack = knowledgeManager.get();\\\\n                const CHUNK_SIZE = 500;\\\\n                const chunks = [];\\\\n                for (let i = 0; i < inventory.length; i += CHUNK_SIZE) {\\\\n                    chunks.push(inventory.slice(i, i + CHUNK_SIZE));\\\\n                }\\\\n                let completedChunks = 0;\\\\n                const allResults = [];\\\\n                const summary = { totalItems: inventory.length, accepted: 0, review: 0, rejected: 0, categoryCounts: {} };\\\\n                worker.onmessage = (e) => {\\\\n                    if (e.data.error) {\\\\n                        worker.terminate();\\\\n                        return reject(new Error(e.data.error));\\\\n                    }\\\\n                    const chunkResults = e.data.results;\\\\n                    if (chunkResults) {\\\\n                        allResults.push(...chunkResults);\\\\n                        chunkResults.forEach(result => {\\\\n                            if (result.Decision === \\\'Accepted\\\') summary.accepted++;\\\\n                            else if (result.Decision === \\\'Review\\\') summary.review++;\\\\n                            else if (result.Decision === \\\'Rejected\\\') summary.rejected++;\\\\n                            if (result.Decision === \\\'Accepted\\\' || result.Decision === \\\'Review\\\') {\\\\n                                summary.categoryCounts[result.PT_Category] = (summary.categoryCounts[result.PT_Category] || 0) + 1;\\\\n                            }\\\\n                        });\\\\n                    }\\\\n                    completedChunks++;\\\\n                    const progress = Math.round((completedChunks / chunks.length) * 100);\\\\n                    onProgress(progress);\\\\n                    if (completedChunks === chunks.length) {\\\\n                        worker.terminate();\\\\n                        resolve({ results: allResults, summary });\\\\n                    }\\\\n                };\\\\n                worker.onerror = (e) => {\\\\n                    worker.terminate();\\\\n                    const errorMessage = e.message ? \\\\`Worker error: \\\\${e.message}\\\\` : \\\\\\\"An unknown error occurred in the analysis worker.\\\\\\\";\\\\n                    reject(new Error(errorMessage));\\\\n                };\\\\n                onProgress(0);\\\\n                chunks.forEach(chunk => {\\\\n                    worker.postMessage({ chunk, knowledgePack });\\\\n                });\\\\n            });\\\\n        }\\\\n        function parseFile(file) {\\\\n            const extension = file.name.split(\\\'.\\\').pop()?.toLowerCase();\\\\n            switch (extension) {\\\\n                case \\\'xlsx\\\': case \\\'xls\\\': return parseXlsx(file);\\\\n                case \\\'csv\\\': return parseCsv(file);\\\\n                case \\\'json\\\': return parseJson(file);\\\\n                default: return Promise.reject(new Error(\\\\`Unsupported file type: .\\\\${extension}. Please upload an Excel, CSV, or JSON file.\\\\`));\\\\n            }\\\\n        }\\\\n        function parseXlsx(file) {\\\\n            return new Promise((resolve, reject) => {\\\\n                const reader = new FileReader();\\\\n                reader.onload = (e) => {\\\\n                    try {\\\\n                        const data = new Uint8Array(e.target.result);\\\\n                        const workbook = XLSX.read(data, { type: \\\'array\\\' });\\\\n                        const sheetName = workbook.SheetNames[0];\\\\n                        const worksheet = workbook.Sheets[sheetName];\\\\n                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });\\\\n                        resolve(normalizeData(jsonData));\\\\n                    } catch (error) {\\\\n                        reject(new Error(\\\\\\\"Failed to parse the Excel file. It may be corrupt or in an unsupported format.\\\\\\\"));\\\\n                    }\\\\n                };\\\\n                reader.onerror = () => reject(new Error(\\\\\\\"Failed to read the file.\\\\\\\"));\\\\n                reader.readAsArrayBuffer(file);\\\\n            });\\\\n        }\\\\n        function parseCsv(file) {\\\\n            return new Promise((resolve, reject) => {\\\\n                Papa.parse(file, {\\\\n                    skipEmptyLines: true,\\\\n                    complete: (results) => {\\\\n                        try {\\\\n                            if (results.errors && results.errors.length > 0) return reject(new Error(\\\\`CSV parsing error: \\\\${results.errors[0].message}\\\\`));\\\\n                            resolve(normalizeData(results.data));\\\\n                        } catch(e) { reject(e); }\\\\n                    },\\\\n                    error: (csvParseError) => reject(new Error(\\\\`CSV parsing failed: \\\\${csvParseError.message}\\\\`)),\\\\n                });\\\\n            });\\\\n        }\\\\n        function parseJson(file) {\\\\n            return new Promise((resolve, reject) => {\\\\n                const reader = new FileReader();\\\\n                reader.onload = (e) => {\\\\n                    try {\\\\n                        const data = JSON.parse(e.target.result);\\\\n                        if (!Array.isArray(data)) return reject(new Error(\\\\\\\"JSON file must contain an array of items.\\\\\\\"));\\\\n                        if (data.length > 0 && typeof data[0].item_name === \\\'undefined\\\') return reject(new Error(\\\\\\\"JSON items must have an \\\'item_name\\\' property.\\\\\\\"));\\\\n                        resolve(data.map((item, index) => ({ id: \\\\`item-\\\\${index}\\\\`, ...item })));\\\\n                    } catch (err) { reject(new Error(\\\\\\\"Failed to parse the JSON file. Please ensure it is well-formed.\\\\\\\")); }\\\\n                };\\\\n                reader.onerror = () => reject(new Error(\\\\\\\"Failed to read the file.\\\\\\\"));\\\\n                reader.readAsText(file);\\\\n            });\\\\n        }\\\\n        function normalizeData(rows) {\\\\n            if (rows.length < 2) throw new Error(\\\\\\\"Inventory file must contain a header row and at least one data row.\\\\\\\");\\\\n            const headerRow = rows[0].map(String);\\\\n            const dataRows = rows.slice(1);\\\\n            const headerMap = createHeaderMap(headerRow);\\\\n            if (!Object.values(headerMap).includes(\\\'item_name\\\')) {\\\\n                const descriptionEntry = Object.entries(headerMap).find(([, key]) => key === \\\'description\\\');\\\\n                if (descriptionEntry) headerMap[parseInt(descriptionEntry[0], 10)] = \\\'item_name\\\';\\\\n            }\\\\n            if (!Object.values(headerMap).includes(\\\'item_name\\\')) {\\\\n                const detectedHeaders = headerRow.filter(h => h).join(\\\', \\\');\\\\n                throw new Error(\\\\`Could not find a required \\\'item_name\\\' column (or a valid alias). Detected headers in your file are: [\\\\${detectedHeaders}]. Please check your column names.\\\\`);\\\\n            }\\\\n            const normalizedItems = [];\\\\n            dataRows.forEach((row, rowIndex) => {\\\\n                if(row.every(cell => cell === null || cell === \\\'\\\' || cell === undefined)) return;\\\\n                const item = { id: \\\\`item-\\\\${rowIndex + 1}\\\\` };\\\\n                Object.entries(headerMap).forEach(([index, key]) => {\\\\n                    const cellValue = row[parseInt(index, 10)];\\\\n                    if(cellValue !== null && cellValue !== undefined) item[key] = String(cellValue);\\\\n                });\\\\n                if (item.item_name && item.item_name.trim() !== \\\'\\\') normalizedItems.push(item);\\\\n            });\\\\n            return normalizedItems;\\\\n        }\\\\n        function createHeaderMap(headerRow) {\\\\n            const fieldAliases = { id: [\\\'id\\\'], item_name: [\\\'item name\\\', \\\'product name\\\', \\\'title\\\', \\\'name\\\', \\\'item_name\\\', \\\'description\\\', \\\'الوصف\\\', \\\'اسم المنتج\\\', \\\'اسم الصنف\\\'], category: [\\\'category\\\', \\\'type\\\', \\\'product type\\\', \\\'الفئة\\\', \\\'التصنيف\\\'], description: [\\\'details\\\', \\\'full description\\\', \\\'item description\\\', \\\'الوصف التفصيلي\\\'], brand: [\\\'brand\\\', \\\'manufacturer\\\', \\\'الماركة\\\', \\\'العلامة التجارية\\\', \\\'mfr\\\'], model: [\\\'model\\\', \\\'model number\\\', \\\'model_number\\\', \\\'الموديل\\\'], sku: [\\\'sku\\\', \\\'item code\\\', \\\'product id\\\', \\\'item_code\\\', \\\'رقم المنتج\\\', \\\'item no\\\', \\\'smr code\\\'] };\\\\n            const headerMap = {};\\\\n            const normalizedAliases = Object.entries(fieldAliases).map(([key, aliases]) => ({ key, aliases: aliases.map(a => a.toLowerCase().replace(/[\\\\\\\\s_-]/g, \\\'\\\')) }));\\\\n            headerRow.forEach((header, index) => {\\\\n                if (!header) return;\\\\n                const normalizedHeader = header.toLowerCase().replace(/[\\\\\\\\s_-]/g, \\\'\\\');\\\\n                const foundMapping = normalizedAliases.find(mapping => mapping.aliases.includes(normalizedHeader));\\\\n                if (foundMapping && !Object.values(headerMap).includes(foundMapping.key)) headerMap[index] = foundMapping.key;\\\\n            });\\\\n            return headerMap;\\\\n        }\\\\n        const state = { appState: \\\'initializing\\\', analysisData: null, error: null, progress: 0, filters: { text: \\\'\\\', decision: \\\'All\\\', category: \\\'All\\\', scoreRange: { min: -100, max: 100 } }, isExplainModalOpen: false, selectedItemForExplain: null, language: \\\'en\\\' };\\\\n        const setState = (newState) => { Object.assign(state, newState); render(); };\\\\n        const t = (key, options) => {\\\\n            let translation = translations[state.language][key] || translations[\\\'en\\\'][key] || key;\\\\n            if (options && typeof options.count !== \\\'undefined\\\') {\\\\n                translation = translation.replace(\\\'{count}\\\', String(options.count));\\\\n            }\\\\n            return translation;\\\\n        };\\\\n        function render() {\\\\n            document.getElementById(\\\'root\\\').innerHTML = App();\\\\n            attachEventListeners();\\\\n        }\\\\n        function App() {\\\\n            return `\\\\n                <div class=\\\\\\\"min-h-screen bg-slate-900 text-slate-300 font-sans\\\\\\\" key=\\\\\\\"${state.language}\\\\\\\">\\\\n                    <main class=\\\\\\\"container mx-auto px-4 sm:px-6 lg:px-8 pb-20\\\\\\\">\\\\n                        ${Header()}\\\\n                        <div class=\\\\\\\"mt-8\\\\\\\" id=\\\\\\\"content-area\\\\\\\">\\\\n                            ${renderContent()}\\\\n                        </div>\\\\n                        <div id=\\\\\\\"modal-container\\\\\\\"></div>\\\\n                    </main>\\\\n                </div>\\\\n            `;\\\\n        }\\\\n        function renderContent() {\\\\n            switch (state.appState) {\\\\n                case \\\'success\\\':\\\\n                    return `\\\\n                        <div class=\\\\\\\"space-y-8\\\\\\\">\\\\n                            <div class=\\\\\\\"flex justify-end gap-4\\\\\\\">\\\\n                                <button id=\\\\\\\"export-btn\\\\\\\" class=\\\\\\\"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-500 transition-colors duration-200\\\\\\\">${t(\\\'button_export\\\')}</button>\\\\n                                <button id=\\\\\\\"reset-btn\\\\\\\" class=\\\\\\\"bg-slate-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors duration-200\\\\\\\">${t(\\\'button_analyze_another\\\')}</button>\\\\n                            </div>\\\\n                        </div>\\\\n                    `;\\\\n                case \\\'error\\\':\\\\n                    return `\\\\n                        <div class=\\\\\\\"space-y-6 max-w-2xl mx-auto text-center\\\\\\\">\\\\n                            <div class=\\\\\\\"p-8 bg-red-900/20 border border-red-500 rounded-lg\\\\\\\">\\\\n                                <h3 class=\\\\\\\"text-xl font-bold text-red-400\\\\\\\">${t(\\\'error_title\\\')}</h3>\\\\n                                <p class=\\\\\\\"mt-2 text-red-300\\\\\\\">${state.error}</p>\\\\n                            </div>\\\\n                            <button id=\\\\\\\"reset-btn\\\\\\\" class=\\\\\\\"bg-slate-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors duration-200\\\\\\\">${t(\\\'button_try_again\\\')}</button>\\\\n                        </div>\\\\n                    `;\\\\n                case \\\'initializing\\\':\\\\n                    return `<div class=\\\\\\\"text-center p-8 text-slate-500\\\\\\\">Initializing Analysis Engine...</div>`;\\\\n                case \\\'loading\\\':\\\\n                    return `${FileUpload()} ${Loader()}`;\\\\n                case \\\'idle\\\':\\\\n                default:\\\\n                    return FileUpload();\\\\n            }\\\\n        }\\\\n        function Header() {\\\\n             return `\\\\n                <header class=\\\\\\\"relative text-center py-10\\\\\\\">\\\\n                    <div class=\\\\\\\"absolute top-4 right-4\\\\\\\">\\\\n                        <button id=\\\\\\\"toggle-lang-btn\\\\\\\" class=\\\\\\\"bg-slate-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors duration-200\\\\\\\">\\\\n                            ${state.language === \\\'en\\\' ? \\\'عربي\\\' : \\\'English\\\'}\\\\n                        </button>\\\\n                    </div>\\\\n                    <h1 class=\\\\\\\"text-4xl font-bold text-white tracking-tight sm:text-5xl\\\\\\\">${t(\\\'header_title\\\')}</h1>\\\\n                    <p class=\\\\\\\"mt-4 text-lg text-slate-400\\\\\\\">${t(\\\'header_subtitle\\\')}</p>\\\\n                </header>\\\\n            `;\\\\n        }\\\\n        function FileUpload() {\\\\n            return `\\\\n            <div class=\\\\\\\"max-w-2xl mx-auto\\\\\\\">\\\\n                <div id=\\\\\\\"file-upload-area\\\\\\\" class=\\\\\\\"relative flex flex-col items-center justify-center w-full p-8 border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 border-slate-600 hover:border-slate-500 bg-slate-900\\\\\\\">\\\\n                    <input type=\\\\\\\"file\\\\\\\" id=\\\\\\\"file-upload-input\\\\\\\" class=\\\\\\\"absolute w-full h-full opacity-0 cursor-pointer\\\\\\\" accept=\\\\\\\".json,.csv,.xlsx,.xls\\\\\\\">\\\\n                    <div class=\\\\\\\"text-center\\\\\\\">\\\\n                        <svg xmlns=\\\\\\\"http://www.w3.org/2000/svg\\\\\\\" fill=\\\\\\\"none\\\\\\\" viewBox=\\\\\\\"0 0 24 24\\\\\\\" stroke-width=\\\\\\\"1.5\\\\\\\" stroke=\\\\\\\"currentColor\\\\\\\" class=\\\\\\\"w-12 h-12 mx-auto text-slate-500\\\\\\\"><path stroke-linecap=\\\\\\\"round\\\\\\\" stroke-linejoin=\\\\\\\"round\\\\\\\" d=\\\\\\\"M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V21h18v-3.75M4.5 12a7.5 7.5 0 0115 0v2.25H4.5V12z\\\\\\\"></path></svg>\\\\n                        <p class=\\\\\\\"mt-4 text-lg font-semibold text-slate-300\\\\\\\">\\\\n                            <span class=\\\\\\\"text-teal-400\\\\\\\">${t(\\\'upload_click\\\')}</span> ${t(\\\'upload_drag_drop\\\')}\\\\n                        </p>\\\\n                        <p class=\\\\\\\"text-sm text-slate-500\\\\\\\">${t(\\\'upload_supported_files\\\')}</p>\\\\n                    </div>\\\\n                </div>\\\\n                <div id=\\\\\\\"file-display-area\\\\\\\" class=\\\\\\\"hidden p-6 bg-slate-800 rounded-lg flex-col items-center space-y-4\\\\\\\"></div>\\\\n            </div>\\\\n        `;\\\\n        }\\\\n        function Loader() {\\\\n            return `\\\\n            <div class=\\\\\\\"flex flex-col items-center justify-center text-center p-8 bg-slate-800/50 rounded-lg max-w-lg mx-auto\\\\\\\">\\\\n                <div class=\\\\\\\"w-16 h-16 border-4 border-teal-400 border-t-transparent rounded-full animate-spin\\\\\\\"></div>\\\\n                <p class=\\\\\\\"mt-6 text-xl font-semibold text-white\\\\\\\">${t(\\\'loader_analyzing\\\')}</p>\\\\n                <div class=\\\\\\\"w-full bg-slate-700 rounded-full h-2.5 mt-4\\\\\\\">\\\\n                    <div class=\\\\\\\"bg-teal-500 h-2.5 rounded-full transition-all duration-300 ease-out\\\\\\\" style=\\\\\\\"width: ${state.progress}%\\\\\\\"></div>\\\\n                </div>\\\\n                <p class=\\\\\\\"mt-2 text-sm text-slate-400\\\\\\\">${state.progress}%</p>\\\\n            </div>\\\\n        `;\\\\n        }\\\\n        function attachEventListeners() {\\\\n            const toggleLangBtn = document.getElementById(\\\'toggle-lang-btn\\\');\\\\n            if (toggleLangBtn) toggleLangBtn.addEventListener(\\\'click\\\', handleToggleLanguage);\\\\n            const fileUploadInput = document.getElementById(\\\'file-upload-input\\\');\\\\n            if(fileUploadInput) fileUploadInput.addEventListener(\\\'change\\\', handleFileChange);\\\\n            const fileUploadArea = document.getElementById(\\\'file-upload-area\\\');\\\\n            if(fileUploadArea) {\\\\n                fileUploadArea.addEventListener(\\\'dragenter\\\', handleDrag);\\\\n                fileUploadArea.addEventListener(\\\'dragleave\\\', handleDrag);\\\\n                fileUploadArea.addEventListener(\\\'dragover\\\', handleDrag);\\\\n                fileUploadArea.addEventListener(\\\'drop\\\', handleDrop);\\\\n            }\\\\n            const analyzeBtn = document.getElementById(\\\'analyze-btn\\\');\\\\n            if(analyzeBtn) analyzeBtn.addEventListener(\\\'click\\\', handleAnalyzeClick);\\\\n            const clearFileBtn = document.getElementById(\\\'clear-file-btn\\\');\\\\n            if(clearFileBtn) clearFileBtn.addEventListener(\\\'click\\\', handleClearFile);\\\\n            const resetBtn = document.getElementById(\\\'reset-btn\\\');\\\\n            if(resetBtn) resetBtn.addEventListener(\\\'click\\\', handleReset);\\\\n        }\\\\n        function handleToggleLanguage() {\\\\n            const newLang = state.language === \\\'en\\\' ? \\\'ar\\\' : \\\'en\\\';\\\\n            document.documentElement.lang = newLang;\\\\n            document.documentElement.dir = newLang === \\\'ar\\\' ? \\\'rtl\\\' : \\\'ltr\\\';\\\\n            setState({ language: newLang });\\\\n        }\\\\n        function handleFileChange(e) {\\\\n            if (e.target.files && e.target.files[0]) {\\\\n                handleFile(e.target.files[0]);\\\\n            }\\\\n        }\\\\n        function handleDrag(e) {\\\\n            e.preventDefault();\\\\n            e.stopPropagation();\\\\n            const area = document.getElementById(\\\'file-upload-area\\\');\\\\n            if (e.type === \\\\\\\"dragenter\\\\\\\" || e.type === \\\\\\\"dragover\\\\\\\") {\\\\n                area.classList.add(\\\'border-teal-400\\\', \\\'bg-slate-800\\\');\\\\n                area.classList.remove(\\\'border-slate-600\\\', \\\'bg-slate-900\\\');\\\\n            } else if (e.type === \\\\\\\"dragleave\\\\\\\") {\\\\n                area.classList.remove(\\\'border-teal-400\\\', \\\'bg-slate-800\\\');\\\\n                area.classList.add(\\\'border-slate-600\\\', \\\'bg-slate-900\\\');\\\\n            }\\\\n        }\\\\n        function handleDrop(e) {\\\\n            e.preventDefault();\\\\n            e.stopPropagation();\\\\n            const area = document.getElementById(\\\'file-upload-area\\\');\\\\n            area.classList.remove(\\\'border-teal-400\\\', \\\'bg-slate-800\\\');\\\\n            area.classList.add(\\\'border-slate-600\\\', \\\'bg-slate-900\\\');\\\\n            if (e.dataTransfer.files && e.dataTransfer.files[0]) {\\\\n                handleFile(e.dataTransfer.files[0]);\\\\n            }\\\\n        }\\\\n        let selectedFile = null;\\\\n        function handleFile(file) {\\\\n            const allowedExtensions = [\\\'.json\\\', \\\'.csv\\\', \\\'.xlsx\\\', \\\'.xls\\\'];\\\\n            const fileExtension = \\\'.\\\' + file.name.split(\\\'.\\\').pop()?.toLowerCase();\\\\n            if (allowedExtensions.includes(fileExtension)) {\\\\n                selectedFile = file;\\\\n                showFileDisplay(file);\\\\n            } else {\\\\n                alert(t(\\\'alert_invalid_file\\\'));\\\\n            }\\\\n        }\\\\n        function showFileDisplay(file) {\\\\n            const fileUploadArea = document.getElementById(\\\'file-upload-area\\\');\\\\n            const fileDisplayArea = document.getElementById(\\\'file-display-area\\\');\\\\n            fileUploadArea.classList.add(\\\'hidden\\\');\\\\n            fileDisplayArea.classList.remove(\\\'hidden\\\');\\\\n            fileDisplayArea.innerHTML = `\\\\n                <div class=\\\\\\\"flex items-center space-x-4 w-full\\\\\\\">\\\\n                    <svg xmlns=\\\\\\\"http://www.w3.org/2000/svg\\\\\\\" fill=\\\\\\\"none\\\\\\\" viewBox=\\\\\\\"0 0 24 24\\\\\\\" stroke-width=\\\\\\\"1.5\\\\\\\" stroke=\\\\\\\"currentColor\\\\\\\" class=\\\\\\\"w-10 h-10 text-teal-400 flex-shrink-0\\\\\\\"><path stroke-linecap=\\\\\\\"round\\\\\\\" stroke-linejoin=\\\\\\\"round\\\\\\\" d=\\\\\\\"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z\\\\\\\"></path></svg>\\\\n                    <div class=\\\\\\\"flex-grow overflow-hidden\\\\\\\">\\\\n                         <p class=\\\\\\\"font-medium text-white truncate\\\\\\\">${file.name}</p>\\\\n                         <p class=\\\\\\\"text-sm text-slate-400\\\\\\\">${(file.size / 1024).toFixed(2)} KB</p>\\\\n                    </div>\\\\n                    <button id=\\\\\\\"clear-file-btn\\\\\\\" class=\\\\\\\"p-1 text-slate-500 hover:text-white transition-colors\\\\\\\">\\\\n                        <svg xmlns=\\\\\\\"http://www.w3.org/2000/svg\\\\\\\" fill=\\\\\\\"none\\\\\\\" viewBox=\\\\\\\"0 0 24 24\\\\\\\" stroke-width=\\\\\\\"1.5\\\\\\\" stroke=\\\\\\\"currentColor\\\\\\\" class=\\\\\\\"w-6 h-6\\\\\\\"><path stroke-linecap=\\\\\\\"round\\\\\\\" stroke-linejoin=\\\\\\\"round\\\\\\\" d=\\\\\\\"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z\\\\\\\"></path></svg>\\\\n                    </button>\\\\n                </div>\\\\n                <button id=\\\\\\\"analyze-btn\\\\\\\" class=\\\\\\\"w-full bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-500 transition-colors duration-200\\\\\\\">\\\\n                    ${t(\\\'button_analyze_now\\\')}\\\\n                </button>\\\\n            `;\\\\n            attachEventListeners();\\\\n        }\\\\n        function handleClearFile() {\\\\n            selectedFile = null;\\\\n            const fileUploadArea = document.getElementById(\\\'file-upload-area\\\');\\\\n            const fileDisplayArea = document.getElementById(\\\'file-display-area\\\');\\\\n            fileUploadArea.classList.remove(\\\'hidden\\\');\\\\n            fileDisplayArea.classList.add(\\\'hidden\\\');\\\\n        }\\\\n        function handleAnalyzeClick() {\\\\n            if (selectedFile) {\\\\n               handleFileSelect(selectedFile);\\\\n            }\\\\n        }\\\\n        function handleReset() {\\\\n            setState({ appState: \\\'idle\\\', analysisData: null, error: null, progress: 0 });\\\\n        }\\\\n        async function handleFileSelect(file) {\\\\n            setState({ appState: \\\'loading\\\', error: null, analysisData: null, progress: 0 });\\\\n            try {\\\\n                const parsedItems = await parseFile(file);\\\\n                const data = await analyzeInventoryWithWorker(parsedItems, knowledgeManager, (p) => setState({ progress: p }));\\\\n                setState({ analysisData: data, appState: \\\'success\\\' });\\\\n            } catch (err) {\\\\n                console.error(err);\\\\n                const errorMessage = err instanceof Error ? err.message : \\\'An unexpected error occurred during analysis.\\\\n                setState({ error: errorMessage + \\\' Please check the file format and content.\\\\n, appState: \\\'error\\\' });\\\\n            }\\\\n        }\\\\n        document.addEventListener(\\\'DOMContentLoaded\\\', () => {\\\\n            const km = new KnowledgeManager();\\\\n            km.load().then(() => {\\\\n                setState({ appState: \\\'idle\\\' });\\\\n            }).catch(err => {\\\\n                setState({ appState: \\\'error\\\', error: err.message });\\\\n            });\\\\n        });\\\\n    </script>\\\\n</body>\\\\n</html>\\\\n---END index.html---